<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Testing of JavaScript Actions &#183; cardinalby</title><meta name=description content="Let&rsquo;s talk about JavaScript GitHub Actions and approaches that we can apply on the different levels of testing.
Unit tests From my point of view, unit testing of Actions doesn&rsquo;t have any differences from testing any other JavaScript code. In most of the examples of Actions available on the GitHub Marketplace authors don&rsquo;t care about writing testable code. But nothing prevents you from extracting abstractions and following The Dependency Inversion Principle which will allow you to easily mock dependencies (such as @actions/core , @actions/github, @actions/exec packages)."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.94.2"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Testing of JavaScript Actions"><meta property="og:description" content="Let&rsquo;s talk about JavaScript GitHub Actions and approaches that we can apply on the different levels of testing.
Unit tests From my point of view, unit testing of Actions doesn&rsquo;t have any differences from testing any other JavaScript code. In most of the examples of Actions available on the GitHub Marketplace authors don&rsquo;t care about writing testable code. But nothing prevents you from extracting abstractions and following The Dependency Inversion Principle which will allow you to easily mock dependencies (such as @actions/core , @actions/github, @actions/exec packages)."><meta property="og:type" content="article"><meta property="og:url" content="https://cardinalby.github.io/blog/post/github-actions/testing/2-testing-of-js-actions/"><link rel=stylesheet href=https://cardinalby.github.io/blogdist/site.css><link rel=stylesheet href=https://cardinalby.github.io/blogdist/syntax.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><link rel="shortcut icon" type=image/jpg href=https://cardinalby.github.io/blog/favicon.png><link rel=stylesheet href=https://cardinalby.github.io/blog/css/custom.css></head><body><script async src="https://www.googletagmanager.com/gtag/js?id=G-S1HYRNQV86"></script>
<script>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-S1HYRNQV86",{anonymize_ip:!0})}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://cardinalby.github.io/blog>Tech grumbling</a></h1><a class=button-square href=https://cardinalby.github.io/blogindex.xml aria-label=RSS><i class="fa fa-rss" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint=Github aria-label=Github href=https://github.com/cardinalby rel=me><i class="fa fa-github-alt" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint="Stack Overflow" aria-label="Stack Overflow" href=https://stackoverflow.com/users/1180397/cardinal rel=me><i class="fa fa-stack-overflow" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint=LinkedIn aria-label=LinkedIn href=https://www.linkedin.com/in/sergey-borodin/ rel=me><i class="fa fa-linkedin" aria-hidden=true></i></a></div><ul class=site-nav><li class=site-nav-item><a href=/blog/>Blog</a></li><li class=site-nav-item><a href=/blog/project/>Projects</a></li><li class=site-nav-item><a href=/blog/tags/>Tags</a></li><li class=site-nav-item><a href=/blog/page/about/>About</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Testing of JavaScript Actions</h1><p class=post-date><span>Published <time datetime=2021-12-02 itemprop=datePublished>Dec 2, 2021</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=https://github.com/cardinalby itemprop=url rel=author>cardinalby</a></span></span></p><p class="post-reading post-line"><span>Estimated reading time: 3 min</span></p></header><img src=../../../../images/posts/github-actions/testing/title.png><div class=series-parts-block><div class=series-parts-title><div class=series-label>SERIES</div><div class=series-name><a href=/blog/series/testing-of-github-actions>Testing of GitHub Actions</a></div></div><div class=series-part><span class=circled-number>1</span>
<a href=https://cardinalby.github.io/blog/post/github-actions/testing/1-testing-of-github-actions-intro/>Testing of GitHub Actions. Intro</a></div><div class="series-part current"><span class=circled-number>2</span>
<a href=https://cardinalby.github.io/blog/post/github-actions/testing/2-testing-of-js-actions/>Testing of JavaScript Actions</a></div><div class=series-part><span class=circled-number>3</span>
<a href=https://cardinalby.github.io/blog/post/github-actions/testing/3-testing-of-docker-actions/>Testing of Docker Actions</a></div><div class=series-part><span class=circled-number>4</span>
<a href=https://cardinalby.github.io/blog/post/github-actions/testing/4-system-testing-of-github-actions/>System testing of GitHub Actions</a></div></div><div class="post-content clearfix" itemprop=articleBody><p><img src=../../../../images/posts/github-actions/testing/title.png alt=Title></p><p>Let&rsquo;s talk about JavaScript GitHub Actions and approaches that we can apply on the different levels of testing.</p><h1 id=unit-tests>Unit tests</h1><p>From my point of view, unit testing of Actions doesn&rsquo;t have any differences from testing any other JavaScript code. In most of the examples of Actions available on the GitHub Marketplace authors don&rsquo;t care about
<a href=https://github.com/mawrkus/js-unit-testing-guide target=_blank>writing testable code</a>. But nothing prevents you from extracting abstractions and following
<a href=https://en.wikipedia.org/wiki/Dependency_inversion_principle target=_blank>The Dependency Inversion Principle</a> which will allow you to easily mock dependencies (such as <code>@actions/core</code> , <code>@actions/github</code>, <code>@actions/exec</code> packages).</p><p>You can use any of JavaScript testing frameworks and mocking libraries. I can advise taking a look at
<a href=https://github.com/jonabc/actions-mocks target=_blank>actions-mocks</a> package.</p><h1 id=integration-tests>Integration tests</h1><p>I&rsquo;m not going to duplicate
<a href=https://github.com/cardinalby/github-action-ts-run-api/blob/master/README.md target=_blank>the documentation</a> for the <em>github-action-ts-run-api</em> package here, but I want to mention how it can be used.</p><h2 id=test-a-separate-js-functionhttpsgithubcomcardinalbygithub-action-ts-run-apiblobmasterdocsrun-targetsmdsingle-function-target>Test a separate
<a href=https://github.com/cardinalby/github-action-ts-run-api/blob/master/docs/run-targets.md#single-function-target target=_blank>JS function</a></h2><p>You can import the main function of your action or the function that implements a part of action&rsquo;s logic and run it in the same process as testing code (but still have all required isolation).
It&rsquo;s up to you to decide what granularity of testing you need.</p><p>As in unit tests you can mock external services, but all outputs, inputs and environment will be handled by the package, no mocks here.</p><p>Check out
<a href=https://github.com/cardinalby/github-action-ts-run-api#testing-isolated-javascript-function target=_blank>the example</a> of testing a simple function.</p><h3 id=remarks>Remarks</h3><p>ðŸ”» <code>process.exit(...)</code> calls inside a function are not mocked and will lead to process termination without cleaning up test environment. Try to avoid them.</p><p>ðŸ”» Keep in mind that <code>require("@actions/github").context</code> is cached inside the actions library which can cause troubles if you run multiple test cases. To get it around you can:</p><ul><li>Use <code>new (require("@actions/github/lib/context").Context)()</code> instead.</li><li>Call <code>jest.resetModules()</code> (or its analog) after each test case run.</li></ul><h2 id=test-a-js-filehttpsgithubcomcardinalbygithub-action-ts-run-apiblobmasterdocsrun-targetsmdjs-file-target>Test a
<a href=https://github.com/cardinalby/github-action-ts-run-api/blob/master/docs/run-targets.md#js-file-target target=_blank>JS file</a></h2><p>It&rsquo;s executed in a child node process. It can be the main packed file of an action (specified in <code>runs.main</code> section of <em>action.yml</em> file) or one of source JS files. Normally, you pack a JS action to a single file using tools like
<a href=https://github.com/vercel/ncc target=_blank>ncc</a> before publishing.
It makes debugging difficult if you use run test agains the packed file.</p><p>Testing js files you can&rsquo;t directly mock classes and functions (which is ok for integration testing), but instead you should have the entire external services
<a href=https://en.wikipedia.org/wiki/Test_stub target=_blank>stubs</a>.</p><h2 id=filesystem-modifications>Filesystem modifications</h2><p>Working with a filesystem follows the common principle: don&rsquo;t use hardcoded paths, rely on
<a href=https://github.com/cardinalby/github-action-ts-run-api/blob/master/docs/run-targets/docker.md#paths-in-container target=_blank>the environment variables</a> provided by GitHub instead.</p><p><em>github-action-ts-run-api</em> allows you to prepare contents of all these dirs and files before the tested action run and examine their contents after it has finished.
<a href=https://github.com/cardinalby/github-action-ts-run-api/blob/master/docs/run-options.md#-setfakefsoptions target=_blank>By default</a>, temporary directories and files are created and corresponding environment variables are set to point to these temporary paths.</p><h2 id=stubbing-external-services>Stubbing external services</h2><p>Don&rsquo;t hardcode URLs of external services in your code:</p><ul><li>For GitHub API use the dedicated <code>GITHUB_API_URL</code>, <code>GITHUB_SERVER_URL</code>, <code>GITHUB_GRAPHQL_URL</code>
<a href=https://docs.github.com/en/actions/learn-github-actions/environment-variables target=_blank>environment variables</a>.</li><li>For other external services introduce custom env variables that can be set in tests. In they are empty action just uses real production URLs.</li></ul><p>It&rsquo;s easy to create a stub HTTP server right in the test suite and set these environment variables to <code>localhost</code> URLs.</p><p>Check out
<a href=https://github.com/cardinalby/github-action-ts-run-api/blob/master/docs/run-targets/js-file.md#-stubbing-github-api-by-local-nodejs-http-server target=_blank>the example</a> of stubbing GitHub API called using octokit library.</p></div><div class=series-parts-block><div class=series-parts-title><div class=series-label>SERIES</div><div class=series-name><a href=/blog/series/testing-of-github-actions>Testing of GitHub Actions</a></div></div><div class=series-part><span class=circled-number>1</span>
<a href=https://cardinalby.github.io/blog/post/github-actions/testing/1-testing-of-github-actions-intro/>Testing of GitHub Actions. Intro</a></div><div class="series-part current"><span class=circled-number>2</span>
<a href=https://cardinalby.github.io/blog/post/github-actions/testing/2-testing-of-js-actions/>Testing of JavaScript Actions</a></div><div class=series-part><span class=circled-number>3</span>
<a href=https://cardinalby.github.io/blog/post/github-actions/testing/3-testing-of-docker-actions/>Testing of Docker Actions</a></div><div class=series-part><span class=circled-number>4</span>
<a href=https://cardinalby.github.io/blog/post/github-actions/testing/4-system-testing-of-github-actions/>System testing of GitHub Actions</a></div></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=/blog/tags/github-actions/>github-actions</a>,
<a href=/blog/tags/js/>js</a>,
<a href=/blog/tags/testing/>testing</a></p><div class=share></div></footer><div class=comments></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://cardinalby.github.io/blog>Tech grumbling</a></h1><a class="button-square button-jump-top js-jump-top" href=# aria-label="Back to Top"><i class="fa fa-angle-up" aria-hidden=true></i></a></div><p class=footer-copyright><span>&copy; 2022 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p></div></footer><script src=https://cardinalby.github.io/blogjs/jquery-1.11.3.min.js></script>
<script src=https://cardinalby.github.io/blogjs/jquery.fitvids.js></script>
<script src=https://cardinalby.github.io/blogjs/scripts.js></script>
<script src=/js/copy-code-to-clipboard.js></script></body></html>