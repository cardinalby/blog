<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>DRY: reusing code in GitHub Actions &#183; cardinalby</title><meta name=description content="In this post I want to make a quick overview of the approaches of reusing steps of your workflow to avoid duplication of the same steps across different workflows or jobs.
游댲 Reusing workflows The obvious option is using the &ldquo;Reusable workflows&rdquo; feature that allows you to extract some steps into a separate &ldquo;reusable&rdquo; workflow and call this workflow as a job in other workflows.
游보 Takeaways: Reusable workflows can&rsquo;t call other reusable workflows."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.109.0"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="DRY: reusing code in GitHub Actions"><meta property="og:description" content="In this post I want to make a quick overview of the approaches of reusing steps of your workflow to avoid duplication of the same steps across different workflows or jobs.
游댲 Reusing workflows The obvious option is using the &ldquo;Reusable workflows&rdquo; feature that allows you to extract some steps into a separate &ldquo;reusable&rdquo; workflow and call this workflow as a job in other workflows.
游보 Takeaways: Reusable workflows can&rsquo;t call other reusable workflows."><meta property="og:type" content="article"><meta property="og:url" content="https://cardinalby.github.io/blog/post/github-actions/dry-reusing-code-in-github-actions/"><link rel=stylesheet href=https://cardinalby.github.io/blog/dist/site.css><link rel=stylesheet href=https://cardinalby.github.io/blog/dist/syntax.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><base href=https://cardinalby.github.io/blog/><link rel="shortcut icon" type=image/jpg href=favicon.png><link rel=stylesheet href=css/custom.css></head><body><script async src="https://www.googletagmanager.com/gtag/js?id=G-S1HYRNQV86"></script>
<script>var dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-S1HYRNQV86",{anonymize_ip:!0})}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://cardinalby.github.io/blog/>Tech grumbling</a></h1><a class=button-square href=https://cardinalby.github.io/blog/index.xml aria-label=RSS><i class="fa fa-rss" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint=Github aria-label=Github href=https://github.com/cardinalby rel=me><i class="fa fa-github-alt" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint="Stack Overflow" aria-label="Stack Overflow" href=https://stackoverflow.com/users/1180397/cardinal rel=me><i class="fa fa-stack-overflow" aria-hidden=true></i></a>
<a class="button-square button-social hint--top" data-hint=LinkedIn aria-label=LinkedIn href=https://www.linkedin.com/in/sergey-borodin/ rel=me><i class="fa fa-linkedin" aria-hidden=true></i></a></div><ul class=site-nav><li class=site-nav-item><a href=/blog/>Blog</a></li><li class=site-nav-item><a href=/blog/project/>Projects</a></li><li class=site-nav-item><a href=/blog/tags/>Tags</a></li><li class=site-nav-item><a href=/blog/page/about/>About</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">DRY: reusing code in GitHub Actions</h1><p class=post-date><span>Published <time datetime=2021-12-06 itemprop=datePublished>Dec 6, 2021</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=https://github.com/cardinalby itemprop=url rel=author>cardinalby</a></span></span></p><p class="post-reading post-line"><span>Estimated reading time: 3 min</span></p></header><div class="post-content clearfix" itemprop=articleBody><img class=post-featured-image src=images/posts/github-actions/dry-reusing-code-in-github-actions/title.png><p>In this post I want to make a quick overview of the approaches of reusing steps of your workflow to avoid duplication of the same steps across different workflows or jobs.</p><h2 id=-reusing-workflows>游댲 Reusing workflows</h2><p>The obvious option is using the
<a href=https://docs.github.com/en/actions/using-workflows/reusing-workflows target=_blank>&ldquo;Reusable workflows&rdquo; feature</a> that allows you to extract some steps into a separate &ldquo;reusable&rdquo; workflow and call this workflow as a job in other workflows.</p><h3 id=-takeaways>游보 Takeaways:</h3><ul><li>Reusable workflows can&rsquo;t call other reusable workflows.</li><li>The <code>strategy</code> property is not supported in any job that calls a reusable workflow.</li><li>Env variables and secrets are not inherited.</li><li>It&rsquo;s not convenient if you need to extract and reuse several steps inside one job.</li><li>Since it runs as a separate job, you have to use
<a href=https://docs.github.com/en/actions/advanced-guides/storing-workflow-data-as-artifacts target=_blank>build artifacts</a> to share files between a reusable workflow and your main workflow.</li><li>You can call a reusable workflow in synchronous or asynchronous manner (managing it by jobs ordering using <code>needs</code> keys).</li><li>A reusable workflow can define outputs that extract outputs/outcomes from executed steps. They can be easily used to pass data to the &ldquo;main&rdquo; workflow.</li></ul><h2 id=-dispatched-workflows>游댲 Dispatched workflows</h2><p>Another possibility that GitHub gives us is
<a href=https://docs.github.com/en/actions/managing-workflow-runs/manually-running-a-workflow target=_blank>workflow_dispatch</a> event that can trigger a workflow run. Simply put, you can trigger a workflow manually or through GitHub API and provide its inputs.</p><p>There are
<a href="https://github.com/marketplace?type=actions&query=dispatch+workflow+" target=_blank>actions</a> available on the Marketplace which allow you to trigger a &ldquo;dispatched&rdquo; workflow as a step of &ldquo;main&rdquo; workflow.</p><p><a href=https://github.com/aurelien-baudet/workflow-dispatch target=_blank>Some</a> of them also allow doing it in a synchronous manner (wait until dispatched workflow is finished). It is worth to say that this feature is implemented by polling statuses of repo workflows which is
<a href=https://github.com/aurelien-baudet/workflow-dispatch/blob/master/src/workflow-handler.ts#L122 target=_blank>not</a> very reliable, especially in a concurrent environment. Also, it is bounded by GitHub API usage limits and therefore has a delay in finding out a status of dispatched workflow.</p><h3 id=-takeaways-1>游보 Takeaways</h3><ul><li>You can have multiple nested calls, triggering a workflow from another triggered workflow. If done careless, can lead to an infinite loop.</li><li>You need a special token with &ldquo;workflows&rdquo; permission; your usual <code>secrets.GITHUB_TOKEN</code> doesn&rsquo;t allow you to dispatch a workflow.</li><li>You can trigger multiple dispatched workflows inside one job.</li><li>There is no easy way to get some data back from dispatched workflows to the main one.</li><li>Works better in &ldquo;fire and forget&rdquo; scenario. Waiting for a finish of dispatched workflow has some limitations.</li><li>You can observe dispatched workflows runs and cancel them manually.</li></ul><h2 id=-composite-actions>游댲 Composite Actions</h2><p>In this approach we extract steps to a distinct
<a href=https://docs.github.com/en/actions/creating-actions/creating-a-composite-action target=_blank>composite action</a>, that can be located in the same or separate repository.</p><p>From your &ldquo;main&rdquo; workflow it looks like a usual action (a single step), but internally it consists of multiple steps each of which can call own actions.</p><h3 id=-takeaways-2>游보 Takeaways:</h3><ul><li>Supports nesting: each step of a composite action can use another composite action.</li><li>Bad visualisation of internal steps run: in the &ldquo;main&rdquo; workflow it&rsquo;s displayed as a usual step run. In raw logs you can find details of internal steps execution, but it doesn&rsquo;t look very friendly.</li><li>Shares environment variables with a parent job, but doesn&rsquo;t share secrets, which should be passed explicitly via inputs.</li><li>Supports inputs and outputs. Outputs are prepared from outputs/outcomes of internal steps and can be easily used to pass data from composite action to the &ldquo;main&rdquo; workflow.</li><li>A composite action runs inside the job of the &ldquo;main&rdquo; workflow. Since they share a common file system, there is no need to use build artifacts to transfer files from the composite action to the &ldquo;main&rdquo; workflow.</li><li>You can&rsquo;t use <code>continue-on-error</code> option inside a composite action.</li></ul><h2 id=-thank-you-for-reading>游녪 Thank you for reading</h2><p>Any comments, critics and sharing your own experience would be appreciated!</p><p>If you are interested in developing own Actions, I also recommend you reading &ldquo;
<a href=/blog/post/github-actions/testing/1-testing-of-github-actions-intro/>GitHub Actions Testing</a>&rdquo; series.</p></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=/tags/github-actions/>github-actions</a></p><div class=share></div></footer><div class=comments><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//https-cardinalby-github-io-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=https://cardinalby.github.io/blog/>Tech grumbling</a></h1><a class="button-square button-jump-top js-jump-top" href=# aria-label="Back to Top"><i class="fa fa-angle-up" aria-hidden=true></i></a></div><p class=footer-copyright><span>&copy; 2023 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p></div></footer><script src=https://cardinalby.github.io/blog/js/jquery-1.11.3.min.js></script>
<script src=https://cardinalby.github.io/blog/js/jquery.fitvids.js></script>
<script src=https://cardinalby.github.io/blog/js/scripts.js></script>
<script src=js/copy-code-to-clipboard.js></script></body></html>